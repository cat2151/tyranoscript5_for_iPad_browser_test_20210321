# 概要
- ティラノスクリプトでコードを書いていたところ、特定条件で、iPadでのみ進行不能になりました。
- 原因調査したところ、issuesに報告したほうがよさそうなので、まとめました。
- やりたいことは
  - 進行不能の解決 → 応急対応で解決しました。
  - 根本原因の解明 → わからず。 → issuesに報告すればわかるかも？
  - コードに問題があるかどうかの解明 → わからず。 → issuesに報告すればわかるかも？

# 状況(2021/03/25)
- 調査中です。
- embはあまり関係ないようです。たまたま「embの前後で」「処理がksファイルの最後まで飛んでしまった」ということのようです。
- なぜ「処理がksファイルの最後まで飛んでしまったか」は調査中です。
- chromeのデベロッパーツールのモバイルエミュレーターにて、logpointを使って、モバイルと非モバイルでそれぞれログをとり、ログの差分をとって調査しています。
- ログの差分のうち、現在見つかっているなかでログ先頭に一番近いものは、linkタグでsetEventしたclick touchstartです。
- クリックで呼ばれます。
- モバイルのときだけ想定外に、1クリックなのに2回目が呼ばれています。
- これにより想定外の位置まで処理が飛んでいます。
- linkタグでsetEventする周囲の処理結果の差分は出ていません。
- このeventはjQueryによるものです。
- jQuery部分は可読性が比較的低いため、logpointによる調査はひとまずスキップしています。
- ですが、jQueryの調査をするほうが筋なのかもしれません。
- その場合、jQueryのどこにlogprintを仕込むのかが見えていません。
- ぐぐると "jquery click touchstart fires twice" というまさにそれっぽいものが見つかりますが、まだ精査していません。

# 詳細
- ティラノスクリプトは、いわゆるブラウザゲームも作ることができます。
- Windowsでコードを書いてテストしながら作成中、気がつくとiPadでのみ進行不能になっていることに気づきました。
- iPadのブラウザであれば、safari、chrome、Firefoxいずれも進行不能となりました。
- ひとまず進行不能を解決する方法は見つかりました。
  - `[button]`タグの表記方法を変更することで解決しました。`first.ks`を参照ください。
- さておき、根本的な原因がわからないこと、コードの問題が見つけられなかったこと、コードの内容からなんとなく、などの理由から、issuesに報告するのがよさそうと考えました。
- 進行不能となる最小のコードを調査しました。
- 最小にしきれていないかもしれません。また、エレガントではありません。再現性を優先したためです。


# DEMO
http://cat2151.github.io/tyranoscript5_for_iPad_browser_test_20210321/

## DEMOの使用方法

- DEMOページをブラウザで開いてください。
- `please_click` をタップまたはクリックしてください。
- 以下を確認してください。
  - Windows PCの場合、`please_click` をクリック後、OKが表示されること。
  - iPadのブラウザ（safariまたはchromeまたFirefox）の場合、`please_click` をクリック後、`OK`が表示されないこと。

# 補足

## コードはどこ？
- この2つです。
https://github.com/cat2151/tyranoscript5_for_iPad_browser_test_20210321/blob/main/data/scenario/first.ks
https://github.com/cat2151/tyranoscript5_for_iPad_browser_test_20210321/blob/main/data/scenario/second.ks

## 確認時のティラノスクリプトのバージョン
- `Ver507a（2021/3/10 更新）`です。

## 進行不能コードの作成方法
- 公式ページ https://tyrano.jp/dl/v5 から、`「ティラノスクリプト V5 」のスタンダードパッケージ` をダウンロードします。
- 同じく公式ページ https://tyrano.jp/studio から、 `ティラノスタジオ` をダウンロードします。
- ティラノスタジオの `system_master/tyranoscript/` と `resources/app/system_master/tyranoscript/` 配下に、`ティラノスクリプト V5` を上書きコピーします。
- ティラノスタジオで新規プロジェクトを作成します。
- プロジェクトの `data\scenario\` を空にし、当リポジトリの `first.ks` と `second.ks` を配置します。

## 再現環境
- iPadで再現しました。
- Windows PC（chromeのデベロッパーツールのモバイルエミュレーター）で再現しました。
